EditorsNotes.zotero = {};

EditorsNotes.zotero.zoteroToCSL = function (zoteroObject) {
  var cslObject = {}
    , z2csl = EditorsNotes.zotero.z2csl
    , typeMap
    , cslFieldMap
    , cslCreatorMap

  typeMap = z2csl.find('typeMap[zType="' + zoteroObject.itemType + '"]');
  cslFieldMap = z2csl.find('cslFieldMap');
  cslCreatorMap = z2csl.find('cslCreatorMap');

  cslObject.type = typeMap.attr('cslType');

  function getFieldKey(key) {
    var baseField = typeMap.find('field[value="' + key + '"]').attr('baseField');
    return baseField || key;
  };

  $.each(zoteroObject, function (key, val) {
    var fieldKey
      , cslKey

    if (!val.length) {
      return true;
    }

    switch (key) {
    case 'itemType':
    case 'tags':
      // Not used to generate a citation
      break;
    case 'creators':
      $.each(val, function () {
        var creatorObject = {}
          , creatorType = this.creatorType
          , cslCreatorKey = getFieldKey(creatorType)

        // Skip empty creators
        if (!(this.firstName || this.lastName || this.name)) {
          return;
        }

        if (!cslObject[cslCreatorKey]) {
          cslObject[cslCreatorKey] = [];
        }

        if (this.firstName || this.lastName) {
          creatorObject.given = this.firstName;
          creatorObject.family = this.lastName;
        } else {
          creatorObject.literal = this.name;
        }

        cslObject[cslCreatorKey].push(creatorObject);
      });
      break;
    case 'date':
      cslObject.issued = {'raw': val};
      break;
    default:
      fieldKey = getFieldKey(key);
      cslKey = cslFieldMap
        .find('fieldMap[zField="' + fieldKey + '"]')
        .attr('cslField');
      cslObject[cslKey] = val;
    }
  });

  return cslObject;
};

// Given a form created by ZoteroForm in forms.py, return one of two objects:
//   1) An array that preserves the order of fields
//   2) A normal object that doesn't
// 
// I'd previously been using the former to send to the server. The latter is
// meant to be used to pass the zotero object to the CSL engine.
EditorsNotes.zotero.zoteroFormToObject = function ($form, sorted) {
  var zoteroObject = {}
    , sortedZoteroObject = {'fields': []}
    , $fields = $form.find('.zotero-entry')
    , indexes = {}

  $.each($fields, function (key, val) {
    var $field = $(val)
      , fieldKey = $field.data('zotero-key')
      , fieldValue
      , fieldObject = {}

    switch (fieldKey) {
    case 'itemType':
      fieldValue = $field.find('input:hidden').val();
      zoteroObject.itemType = fieldValue;
      sortedZoteroObject.fields.push({'itemType': fieldValue});
      break;
    case 'tags':
    case 'creators':
      if (!zoteroObject[fieldKey]) {
        zoteroObject[fieldKey] = [];
        fieldObject[fieldKey] = [];
        indexes[fieldKey] = sortedZoteroObject.fields.push(fieldObject);
      }
      if (fieldKey === 'tags') {
        fieldValue = JSON.parse( $field.find('input:hidden').val() );
      } else {
        fieldValue = (function ($field) {
          var creatorObj = {}
            , attrs = $field.closest('.zotero-entry').find('.creator-attr')

          attrs.each(function (idx, el) {
            creatorObj[el.getAttribute('data-creator-key')] = el.value;
          });
          return creatorObj;
        })($field);
      }
      zoteroObject[fieldKey].push(fieldValue);
      sortedZoteroObject.fields[indexes[fieldKey] - 1].creators.push(fieldValue);
      break;
    default:
      fieldValue = $field.find('textarea').val();
      zoteroObject[fieldKey] = fieldValue;
      fieldObject[fieldKey] = fieldValue;
      sortedZoteroObject.fields.push(fieldObject);
      break;
    }
  });

  return sorted ? sortedZoteroObject : zoteroObject;
};

// This is a mapping from Zotero to CSL
// https://github.com/aurimasv/z2csl/
EditorsNotes.zotero.z2csl = (function () {
  var z2cslXML = $.parseXML('' +
'<map> <zTypes> <typeMap zType="note" cslType=""> </typeMap> <typeMap zType="book" cslType="book"> <field value="title" /> <field value="abstractNote" /> <field value="series" /> <field value="seriesNumber" /> <field value="volume" /> <field value="numberOfVolumes" /> <field value="edition" /> <field value="place" /> <field value="publisher" /> <field value="date" /> <field value="numPages" /> <field value="language" /> <field value="ISBN" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="editor" /> <creatorType value="seriesEditor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="bookSection" cslType="chapter"> <field value="title" /> <field value="abstractNote" /> <field value="bookTitle" baseField="publicationTitle" /> <field value="series" /> <field value="seriesNumber" /> <field value="volume" /> <field value="numberOfVolumes" /> <field value="edition" /> <field value="place" /> <field value="publisher" /> <field value="date" /> <field value="pages" /> <field value="language" /> <field value="ISBN" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="bookAuthor" /> <creatorType value="contributor" /> <creatorType value="editor" /> <creatorType value="seriesEditor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="journalArticle" cslType="article-journal"> <field value="title" /> <field value="abstractNote" /> <field value="publicationTitle" /> <field value="volume" /> <field value="issue" /> <field value="pages" /> <field value="date" /> <field value="series" /> <field value="seriesTitle" /> <field value="seriesText" /> <field value="journalAbbreviation" /> <field value="language" /> <field value="DOI" /> <field value="ISSN" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="editor" /> <creatorType value="reviewedAuthor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="magazineArticle" cslType="article-magazine"> <field value="title" /> <field value="abstractNote" /> <field value="publicationTitle" /> <field value="volume" /> <field value="issue" /> <field value="date" /> <field value="pages" /> <field value="language" /> <field value="ISSN" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="reviewedAuthor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="newspaperArticle" cslType="article-newspaper"> <field value="title" /> <field value="abstractNote" /> <field value="publicationTitle" /> <field value="place" /> <field value="edition" /> <field value="date" /> <field value="section" /> <field value="pages" /> <field value="language" /> <field value="shortTitle" /> <field value="ISSN" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="reviewedAuthor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="thesis" cslType="thesis"> <field value="title" /> <field value="abstractNote" /> <field value="thesisType" baseField="type" /> <field value="university" baseField="publisher" /> <field value="place" /> <field value="date" /> <field value="numPages" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> </field> </typeMap> <typeMap zType="letter" cslType="personal_communication"> <field value="title" /> <field value="abstractNote" /> <field value="letterType" baseField="type" /> <field value="date" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="recipient" /> </field> </typeMap> <typeMap zType="manuscript" cslType="manuscript"> <field value="title" /> <field value="abstractNote" /> <field value="manuscriptType" baseField="type" /> <field value="place" /> <field value="date" /> <field value="numPages" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="interview" cslType="interview"> <field value="title" /> <field value="abstractNote" /> <field value="date" /> <field value="interviewMedium" baseField="medium" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="interviewee" baseField="author" /> <creatorType value="contributor" /> <creatorType value="interviewer" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="film" cslType="motion_picture"> <field value="title" /> <field value="abstractNote" /> <field value="distributor" baseField="publisher" /> <field value="date" /> <field value="genre" baseField="type" /> <field value="videoRecordingFormat" baseField="medium" /> <field value="runningTime" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="director" baseField="author" /> <creatorType value="contributor" /> <creatorType value="producer" /> <creatorType value="scriptwriter" /> </field> </typeMap> <typeMap zType="artwork" cslType="graphic"> <field value="title" /> <field value="abstractNote" /> <field value="artworkMedium" baseField="medium" /> <field value="artworkSize" /> <field value="date" /> <field value="language" /> <field value="shortTitle" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="url" /> <field value="accessDate" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="artist" baseField="author" /> <creatorType value="contributor" /> </field> </typeMap> <typeMap zType="webpage" cslType="webpage"> <field value="title" /> <field value="abstractNote" /> <field value="websiteTitle" baseField="publicationTitle" /> <field value="websiteType" baseField="type" /> <field value="date" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="language" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="attachment" cslType=""> <field value="title" /> <field value="accessDate" /> <field value="url" /> </typeMap> <typeMap zType="report" cslType="report"> <field value="title" /> <field value="abstractNote" /> <field value="reportNumber" baseField="number" /> <field value="reportType" baseField="type" /> <field value="seriesTitle" /> <field value="place" /> <field value="institution" baseField="publisher" /> <field value="date" /> <field value="pages" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="seriesEditor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="bill" cslType="bill"> <field value="title" /> <field value="abstractNote" /> <field value="billNumber" baseField="number" /> <field value="code" /> <field value="codeVolume" baseField="volume" /> <field value="section" /> <field value="codePages" baseField="pages" /> <field value="legislativeBody" /> <field value="session" /> <field value="history" /> <field value="date" /> <field value="language" /> <field value="url" /> <field value="accessDate" /> <field value="shortTitle" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="sponsor" baseField="author" /> <creatorType value="contributor" /> <creatorType value="cosponsor" /> </field> </typeMap> <typeMap zType="case" cslType="legal_case"> <field value="caseName" baseField="title" /> <field value="abstractNote" /> <field value="reporter" /> <field value="reporterVolume" baseField="volume" /> <field value="court" /> <field value="docketNumber" baseField="number" /> <field value="firstPage" baseField="pages" /> <field value="history" /> <field value="dateDecided" baseField="date" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="counsel" /> </field> </typeMap> <typeMap zType="hearing" cslType="bill"> <field value="title" /> <field value="abstractNote" /> <field value="committee" /> <field value="place" /> <field value="publisher" /> <field value="numberOfVolumes" /> <field value="documentNumber" baseField="number" /> <field value="pages" /> <field value="legislativeBody" /> <field value="session" /> <field value="history" /> <field value="date" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="contributor" baseField="author" /> </field> </typeMap> <typeMap zType="patent" cslType="patent"> <field value="title" /> <field value="abstractNote" /> <field value="place" /> <field value="country" /> <field value="assignee" /> <field value="issuingAuthority" /> <field value="patentNumber" baseField="number" /> <field value="filingDate" /> <field value="pages" /> <field value="applicationNumber" /> <field value="priorityNumbers" /> <field value="issueDate" baseField="date" /> <field value="references" /> <field value="legalStatus" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="inventor" baseField="author" /> <creatorType value="attorneyAgent" /> <creatorType value="contributor" /> </field> </typeMap> <typeMap zType="statute" cslType="legislation"> <field value="nameOfAct" baseField="title" /> <field value="abstractNote" /> <field value="code" /> <field value="codeNumber" /> <field value="publicLawNumber" baseField="number" /> <field value="dateEnacted" baseField="date" /> <field value="pages" /> <field value="section" /> <field value="session" /> <field value="history" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> </field> </typeMap> <typeMap zType="email" cslType="personal_communication"> <field value="subject" baseField="title" /> <field value="abstractNote" /> <field value="date" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="language" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="recipient" /> </field> </typeMap> <typeMap zType="map" cslType="map"> <field value="title" /> <field value="abstractNote" /> <field value="mapType" baseField="type" /> <field value="scale" /> <field value="seriesTitle" /> <field value="edition" /> <field value="place" /> <field value="publisher" /> <field value="date" /> <field value="language" /> <field value="ISBN" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="cartographer" baseField="author" /> <creatorType value="contributor" /> <creatorType value="seriesEditor" /> </field> </typeMap> <typeMap zType="blogPost" cslType="post-weblog"> <field value="title" /> <field value="abstractNote" /> <field value="blogTitle" baseField="publicationTitle" /> <field value="websiteType" baseField="type" /> <field value="date" /> <field value="url" /> <field value="accessDate" /> <field value="language" /> <field value="shortTitle" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="commenter" /> <creatorType value="contributor" /> </field> </typeMap> <typeMap zType="instantMessage" cslType="personal_communication"> <field value="title" /> <field value="abstractNote" /> <field value="date" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="recipient" /> </field> </typeMap> <typeMap zType="forumPost" cslType="post"> <field value="title" /> <field value="abstractNote" /> <field value="forumTitle" baseField="publicationTitle" /> <field value="postType" baseField="type" /> <field value="date" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> </field> </typeMap> <typeMap zType="audioRecording" cslType="song"> <field value="title" /> <field value="abstractNote" /> <field value="audioRecordingFormat" baseField="medium" /> <field value="seriesTitle" /> <field value="volume" /> <field value="numberOfVolumes" /> <field value="place" /> <field value="label" baseField="publisher" /> <field value="date" /> <field value="runningTime" /> <field value="language" /> <field value="ISBN" /> <field value="shortTitle" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="url" /> <field value="accessDate" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="performer" baseField="author" /> <creatorType value="composer" /> <creatorType value="contributor" /> <creatorType value="wordsBy" /> </field> </typeMap> <typeMap zType="presentation" cslType="speech"> <field value="title" /> <field value="abstractNote" /> <field value="presentationType" baseField="type" /> <field value="date" /> <field value="place" /> <field value="meetingName" /> <field value="url" /> <field value="accessDate" /> <field value="language" /> <field value="shortTitle" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="presenter" baseField="author" /> <creatorType value="contributor" /> </field> </typeMap> <typeMap zType="videoRecording" cslType="motion_picture"> <field value="title" /> <field value="abstractNote" /> <field value="videoRecordingFormat" baseField="medium" /> <field value="seriesTitle" /> <field value="volume" /> <field value="numberOfVolumes" /> <field value="place" /> <field value="studio" baseField="publisher" /> <field value="date" /> <field value="runningTime" /> <field value="language" /> <field value="ISBN" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="director" baseField="author" /> <creatorType value="castMember" /> <creatorType value="contributor" /> <creatorType value="producer" /> <creatorType value="scriptwriter" /> </field> </typeMap> <typeMap zType="tvBroadcast" cslType="broadcast"> <field value="title" /> <field value="abstractNote" /> <field value="programTitle" baseField="publicationTitle" /> <field value="episodeNumber" baseField="number" /> <field value="videoRecordingFormat" baseField="medium" /> <field value="place" /> <field value="network" baseField="publisher" /> <field value="date" /> <field value="runningTime" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="director" baseField="author" /> <creatorType value="castMember" /> <creatorType value="contributor" /> <creatorType value="guest" /> <creatorType value="producer" /> <creatorType value="scriptwriter" /> </field> </typeMap> <typeMap zType="radioBroadcast" cslType="broadcast"> <field value="title" /> <field value="abstractNote" /> <field value="programTitle" baseField="publicationTitle" /> <field value="episodeNumber" baseField="number" /> <field value="audioRecordingFormat" baseField="medium" /> <field value="place" /> <field value="network" baseField="publisher" /> <field value="date" /> <field value="runningTime" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="director" baseField="author" /> <creatorType value="castMember" /> <creatorType value="contributor" /> <creatorType value="guest" /> <creatorType value="producer" /> <creatorType value="scriptwriter" /> </field> </typeMap> <typeMap zType="podcast" cslType="song"> <field value="title" /> <field value="abstractNote" /> <field value="seriesTitle" /> <field value="episodeNumber" baseField="number" /> <field value="audioFileType" baseField="medium" /> <field value="runningTime" /> <field value="url" /> <field value="accessDate" /> <field value="language" /> <field value="shortTitle" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="podcaster" baseField="author" /> <creatorType value="contributor" /> <creatorType value="guest" /> </field> </typeMap> <typeMap zType="computerProgram" cslType="book"> <field value="title" /> <field value="abstractNote" /> <field value="seriesTitle" /> <field value="version" /> <field value="date" /> <field value="system" /> <field value="place" /> <field value="company" baseField="publisher" /> <field value="programmingLanguage" /> <field value="ISBN" /> <field value="shortTitle" /> <field value="url" /> <field value="rights" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="accessDate" /> <field value="extra" /> <field value="creator"> <creatorType value="programmer" baseField="author" /> <creatorType value="contributor" /> </field> </typeMap> <typeMap zType="conferencePaper" cslType="paper-conference"> <field value="title" /> <field value="abstractNote" /> <field value="date" /> <field value="proceedingsTitle" baseField="publicationTitle" /> <field value="conferenceName" /> <field value="place" /> <field value="publisher" /> <field value="volume" /> <field value="pages" /> <field value="series" /> <field value="language" /> <field value="DOI" /> <field value="ISBN" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="editor" /> <creatorType value="seriesEditor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="document" cslType=""> <field value="title" /> <field value="abstractNote" /> <field value="publisher" /> <field value="date" /> <field value="language" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="editor" /> <creatorType value="reviewedAuthor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="encyclopediaArticle" cslType="entry-encyclopedia"> <field value="title" /> <field value="abstractNote" /> <field value="encyclopediaTitle" baseField="publicationTitle" /> <field value="series" /> <field value="seriesNumber" /> <field value="volume" /> <field value="numberOfVolumes" /> <field value="edition" /> <field value="place" /> <field value="publisher" /> <field value="date" /> <field value="pages" /> <field value="ISBN" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="language" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="editor" /> <creatorType value="seriesEditor" /> <creatorType value="translator" /> </field> </typeMap> <typeMap zType="dictionaryEntry" cslType="entry-dictionary"> <field value="title" /> <field value="abstractNote" /> <field value="dictionaryTitle" baseField="publicationTitle" /> <field value="series" /> <field value="seriesNumber" /> <field value="volume" /> <field value="numberOfVolumes" /> <field value="edition" /> <field value="place" /> <field value="publisher" /> <field value="date" /> <field value="pages" /> <field value="language" /> <field value="ISBN" /> <field value="shortTitle" /> <field value="url" /> <field value="accessDate" /> <field value="archive" /> <field value="archiveLocation" /> <field value="libraryCatalog" /> <field value="callNumber" /> <field value="rights" /> <field value="extra" /> <field value="creator"> <creatorType value="author" /> <creatorType value="contributor" /> <creatorType value="editor" /> <creatorType value="seriesEditor" /> <creatorType value="translator" /> </field> </typeMap> </zTypes> <cslFieldMap> <fieldMap zField="title" cslField="title" /> <fieldMap zField="publicationTitle" cslField="container-title" /> <fieldMap zField="reporter" cslField="container-title" /> <fieldMap zField="code" cslField="container-title" /> <fieldMap zField="seriesTitle" cslField="collection-title" /> <fieldMap zField="series" cslField="collection-title" /> <fieldMap zField="seriesNumber" cslField="collection-number" /> <fieldMap zField="publisher" cslField="publisher" /> <fieldMap zField="distributor" cslField="publisher" /> <fieldMap zField="place" cslField="publisher-place" /> <fieldMap zField="court" cslField="authority" /> <fieldMap zField="pages" cslField="page" /> <fieldMap zField="volume" cslField="volume" /> <fieldMap zField="issue" cslField="issue" /> <fieldMap zField="numberOfVolumes" cslField="number-of-volumes" /> <fieldMap zField="numPages" cslField="number-of-pages" /> <fieldMap zField="edition" cslField="edition" /> <fieldMap zField="version" cslField="version" /> <fieldMap zField="section" cslField="section" /> <fieldMap zField="type" cslField="genre" /> <fieldMap zField="artworkSize" cslField="genre" /> <fieldMap zField="medium" cslField="medium" /> <fieldMap zField="system" cslField="medium" /> <fieldMap zField="archive" cslField="archive" /> <fieldMap zField="archiveLocation" cslField="archive_location" /> <fieldMap zField="meetingName" cslField="event" /> <fieldMap zField="conferenceName" cslField="event" /> <fieldMap zField="place" cslField="event-place" /> <fieldMap zField="abstractNote" cslField="abstract" /> <fieldMap zField="url" cslField="URL" /> <fieldMap zField="DOI" cslField="DOI" /> <fieldMap zField="ISBN" cslField="ISBN" /> <fieldMap zField="callNumber" cslField="call-number" /> <fieldMap zField="extra" cslField="note" /> <fieldMap zField="number" cslField="number" /> <fieldMap zField="history" cslField="references" /> <fieldMap zField="shortTitle" cslField="shortTitle" /> <fieldMap zField="journalAbbreviation" cslField="journalAbbreviation" /> <fieldMap zField="language" cslField="language" /> <fieldMap zField="date" cslField="issued" /> <fieldMap zField="accessDate" cslField="accessed" /> </cslFieldMap> <cslCreatorMap> <creatorMap zCreator="author" cslCreator="author" /> <creatorMap zCreator="editor" cslCreator="editor" /> <creatorMap zCreator="bookAuthor" cslCreator="container-author" /> <creatorMap zCreator="composer" cslCreator="composer" /> <creatorMap zCreator="interviewer" cslCreator="interviewer" /> <creatorMap zCreator="recipient" cslCreator="recipient" /> <creatorMap zCreator="seriesEditor" cslCreator="collection-editor" /> <creatorMap zCreator="translator" cslCreator="translator" /> </cslCreatorMap> </map>');

  return $(z2cslXML);

})();

